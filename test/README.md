# Testing

- [Getting Started on Testing Environment](#get-started-on-testing-environment)
- [Data Type Runtime Testing](#data-type-runtime-testing)
- [Column Select Test](#column-select-test)

## Get Started on Testing Environment

### 1. Install Dart Dependencies

```bash
pub get
```

### 2. Setup Supabase project and use the seed.sql file to create the tables

### 3. Fill up ENV variables

```bash
SUPABASE_URL=
SUPABASE_ANON_KEY=
```

### 4. Generate Dart Classes using the CLI

```bash
dart pub global run supadart -d
# or
supadart -d
# D tag is for dart class and not for flutter/dart class
```

### 5. Run the tests

```bash
dart test
```

---

## Data Type Runtime Testing

### What are we testing for?

- We will test on the runtime of the data types generated by the CLI or web app.
- We will test if the data types are working as expected.

```dart

  test('Testing Boolean Create', () async {
    await cleanup(supabase, supabase.boolean_bit_types);
    var createResult = await createBoolean(supabase, insertBoolean);
    expect(createResult, null);
  });

  test('Testing Boolean Update', () async {
    var updateResult =
        await updateBoolean(supabase, insertBoolean, updatedBoolean);
    expect(updateResult, null);
  });

  test('Testing Boolean Read', () async {
    var readResult = await readBoolean(supabase);
    assert(readResult is List<BooleanBitTypes>);
    expect(readResult!.length, 1);
    expect(readResult[0].col_boolean, isA<bool>());
    expect(readResult[0].col_boolean, updatedBoolean);
  });
```

Remember that what we are testing is the data integrity and runtime of the types generated by the CLI or web app. The tests are not meant to test the actual Supabase API.

---

## Column Select Test

### What are we testing for?

When we do column select, we need to know the default value for the column type. This function provides the default value for the dart type.

```typescript
const dartTypeDefaultNullValue = (dartType: DartType): string => {
  switch (dartType) {
    case "int":
      return "0";
    case "BigInt":
      return "BigInt.from(0)";
    case "double":
      return "0.0";
    case "num":
      return "0";
    case "bool":
      return "false";
    case "String":
      return "''"; // Empty string as default
    case "DateTime":
      return "DateTime.fromMillisecondsSinceEpoch(0)"; // Using Unix epoch as default
    case "Duration":
      return "Duration()"; // Assuming duration in milliseconds
    case "Map<String, dynamic>":
      return "<String, dynamic>{}";
    case "List<int>":
      return "<int>[]";
    case "List<BigInt>":
      return "<BigInt>[]";
    case "List<double>":
      return "<double>[]";
    case "List<num>":
      return "<num>[]";
    case "List<bool>":
      return "<bool>[]";
    case "List<String>":
      return "<String>[]";
    case "List<DateTime>":
      return "<DateTime>[]";
    case "List<Duration>":
      return "<Duration>[]";
    case "List<Map<String, dynamic>>":
      return "<Map<String, dynamic>>[]";
    default:
      return "UNSUPPORTED DART TYPE: PLS OPEN AN ISSUE";
  }
};
```

```dart
dynamic getDefaultValue(
  String dartType,
) {
  switch (dartType) {
    case "int":
      return 0;
    case "BigInt":
      return BigInt.from(0);
    case "double":
      return 0.0;
    case "num":
      return 0;
    case "bool":
      return false;
    case "String":
      return ""; // Empty string as default
    case "DateTime":
      return DateTime.fromMillisecondsSinceEpoch(
          0); // Using Unix epoch as default
    case "Duration":
      return Duration(); // Assuming duration in milliseconds
    case "Map<String, dynamic>":
    case "Map":
      return {};
    case "List":
      return [];
    default:
      return null;
  }
}

```

#### Keep in mind

- We are not testing if it selects the correct value to populate
- We are testing if it selects the default value for a null value

The `fromJson` method can't return a null value or else it will throw an error and will break the program, so we need to provide a default value for the column type. (Please open up an issue if you think the default value is wrong)

This folder contains the test for the `dartTypeDefaultNullValue` function. for each dart type, we will test if the function returns the correct default value.
