# Supabase Schema to Dart Classes 🎯

Generate Dart 🎯 classes from your Supabase schema.

- [Generate Dart Classes](#generating-dart-classes)
- [Example Usage](#example-usage)

## Conversion Table

| Supabase Identifier | Format                      | JSON Type | Dart Type            | Runtime Tested |
| ------------------- | --------------------------- | --------- | -------------------- | -------------- |
| # int2              | smallint                    | integer   | int                  | ✅             |
| # int4              | integer                     | integer   | int                  | ✅             |
| # int8              | bigint                      | integer   | BigInt               | ✅             |
| # float4            | real                        | number    | double               | ✅             |
| # float8            | double precision            | number    | double               | ✅             |
| # numeric           | numeric                     | number    | num                  | ✅             |
| {} json             | json                        | -         | Map<String, dynamic> | ✅             |
| {} jsonb            | jsonb                       | -         | Map<String, dynamic> | ✅             |
| T text              | text                        | string    | String               | ✅             |
| T varchar           | character varying           | string    | String               | ✅             |
| T uuid              | uuid                        | string    | String               | ✅             |
| 🗓️ date             | date                        | string    | DateTime             | ✅             |
| 🗓️ time             | time without time zone      | string    | DateTime             | ✅             |
| 🗓️ timetz           | time with time zone         | string    | DateTime             | ✅             |
| 🗓️ timestamp        | timestamp without time zone | string    | DateTime             | ✅             |
| 🗓️ timestamptz      | timestamp with time zone    | string    | DateTime             | ✅             |
| 💡 bool             | boolean                     | boolean   | bool                 | ✅             |

---

# Generating Dart Classes

## 1. Pre-requisites

#### if you have serial types you need to add a comment to the column like this,

```sql
COMMENT ON COLUMN test_table.bigserialx IS 'serial';
COMMENT ON COLUMN test_table.smallserialx IS 'serial';
COMMENT ON COLUMN test_table.serialx IS 'serial';
-- otherwise the insert method will always ask for a value
```

[Why do we need this?](https://gist.github.com/mmvergara/5e3d42d73dd316f8ff809fb940163c1f)

#### Install `Internationalization` package

```bash
# This is an official package from dart and is used for parsing dates
flutter pub add intl
# or
dart pub add intl
```

## 2. Generate Dart Classes

### Using the [Web App](https://supabase-schema-dart-class-generator.vercel.app/)

### Using the Dart CLI

#### Installation

```bash
# 🎯 Active from pub.dev
dart pub global activate supadart
```

```bash
# 🚀 Run via
supadart
# or
dart pub global run supadart
```

#### Generate Classes

```bash
# If you have a .env file in the root of your project
supadart

# If you have a .env file in a different location
supadart -e path/to/.env

# If you dont have a .env file specify the Supabase URL and ANON KEY
supadart -u <your-supabase-url> -k <your-supabase-anon-key>
```

#### Options

```bash
-h, --help        Show usage information
-e, --env-path    Path to the .env file -- (default: .env)
-u, --url         Supabase URL          -- (default: .env SUPABASE_URL)
-k, --key         Supabase ANON KEY     -- (default: .env SUPABASE_ANON_KEY)
-o, --output      Output file path      -- (default: lib/generated_classes.dart)
```

---

# Example Usage

### 1. Assuming the following table schema

```sql
create table
  public.books (
    id bigint generated by default as identity,
    book_name text not null,
    created_at timestamp with time zone not null default now(),
    book_description text null,
    sold boolean not null default false,
    price double precision not null,
    constraint books_pkey primary key (id),
    constraint books_id_key unique (id)
  ) tablespace pg_default;
```

### 2. Use the CLI or the Web App to [generate dart classes](#generate-dart-classes)

> Example generated class

````dart

```dart
import 'package:supabase_flutter/supabase_flutter.dart';

class Books {
  int id;
  String book_name;
  DateTime created_at;
  String? book_description;
  bool sold;
  double price;

  Books({
    required this.id,
    required this.book_name,
    required this.created_at,
    this.book_description,
    required this.sold,
    required this.price,
  });

  static String get table_name => 'books';
  static Map<String, dynamic> insert({
    int? id,
    required String book_name,
    DateTime? created_at,
    String? book_description,
    required bool sold,
    required double price,
  }) {
    return {
      if (id != null) 'id': id,
      'book_name': book_name,
      if (created_at != null) 'created_at': created_at.toIso8601String(),
      if (book_description != null) 'book_description': book_description,
      'sold': sold,
      'price': price,
    };
  }

  static Map<String, dynamic> update({
    int? id,
    String? book_name,
    DateTime? created_at,
    String? book_description,
    bool? sold,
    double? price,
  }) {
    return {
      if (id != null) 'id': id,
      if (book_name != null) 'book_name': book_name,
      if (created_at != null) 'created_at': created_at,
      if (book_description != null) 'book_description': book_description,
      if (sold != null) 'sold': sold,
      if (price != null) 'price': price,
    };
  }

  factory Books.fromJson(Map<String, dynamic> json) {
    return Books(
      id: json['id'],
      book_name: json['book_name'],
      created_at: DateTime.parse(json['created_at']),
      book_description: json['book_description'],
      sold: json['sold'],
      price: double.parse(json['price'].toString()),
    );
  }
}

extension TypeSafeTable on SupabaseClient {
  SupabaseQueryBuilder get books {
    return from('books');
  }
}

````

### 3. Using the generated class

we now have a typesafe'ish to interact with the database.

### Getting Table Name

```dart
  Books.table_name // "books"
  await supabase.from(Books.table_name).select();
```

### Fetch Data

```dart
// fetchedBooks is a typeof List<Books>
final books = await supabase
      .from(Books.table_name)
      .select("*")
      .withConverter((data) => data.map(Books.fromJson).toList());
```

or we can use the extension

```dart
// fetchedBooks is a typeof List<Books>
final books = await supabase
      .books
      .select("*")
      .withConverter((data) => data.map(Books.fromJson).toList());
```

### Insert Data

```dart
final data = Books.insert(
  book_name: 'Book Name',
  book_description: 'Description',
  price: 2,
);
await supabase.books.insert(data);
```

### Inset Many Data

```dart
final many_data = [
  Books.insert(
    book_name: 'Book Name',
    book_description: 'Description',
    price: 2,
  ),
  Books.insert(
    book_name: 'Book Name 2',
    created_at: DateTime.now().toString(),
    price: 2,
  ),
];
await supabase.books.insert(many_data);
```

### Update Data

```dart
final newData = Books.update(
  book_name: 'New Book Name',
  // we can update any field we want
);
await supabase
    .books
    .update(newData)
    .eq('id', 1)
```

### Delete Data

```dart
await supabase.books.delete().eq('id', 1);
```
