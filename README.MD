# Supabase Schema to Dart Classes (WIP)

Generate Dart classes from your Supabase schema.
[Web App](https://mmvergara.github.io/supabase-schema-dart-class-generator/)

I'm pretty sure we could make this better by making a CLI or adding it to the existing one. But here it is for now. Please feel free to open an issue or a PR 🙏 if you have any ideas or suggestions. I really want to make this better cause i use flutter a lot.

## Example Usage

### 1. Assuming the following table schema

```sql
create table
  public.books (
    id bigint generated by default as identity,
    book_name text not null,
    created_at timestamp with time zone not null default now(),
    book_description text null,
    sold boolean not null default false,
    price double precision not null,
    constraint books_pkey primary key (id),
    constraint books_id_key unique (id)
  ) tablespace pg_default;
```

### 2. Go to the [website](https://mmvergara.github.io/supabase-schema-dart-class-generator/) and input your `SUPABASE_URL` and `SUPABASE_ANON_KEY` to generate the model class.

> Example generated class

```dart
class Books {
  int id;
  String book_name;
  String created_at;
  String? book_description;
  bool sold;
  int price;

  Books({
    required this.id,
    required this.book_name,
    required this.created_at,
    this.book_description,
    required this.sold,
    required this.price,
  });

  static String get table_name => 'books';
  static Map<String, dynamic> insert({
    int? id,
    required String book_name,
    String? created_at,
    String? book_description,
    bool? sold,
    required int price,
  }) {
    return {
      if (id != null) 'id': id,
      'book_name': book_name,
      if (created_at != null) 'created_at': created_at,
      if (book_description != null) 'book_description': book_description,
      if (sold != null) 'sold': sold,
      'price': price,
    };
  }

  static Map<String, dynamic> update({
    int? id,
    String? book_name,
    String? created_at,
    String? book_description,
    bool? sold,
    int? price,
  }) {
    return {
      if (id != null) 'id': id,
      if (book_name != null) 'book_name': book_name,
      if (created_at != null) 'created_at': created_at,
      if (book_description != null) 'book_description': book_description,
      if (sold != null) 'sold': sold,
      if (price != null) 'price': price,
    };
  }

  static Books fromJson(Map<String, dynamic> json) {
    return Books(
      id: json['id'],
      book_name: json['book_name'],
      created_at: json['created_at'],
      book_description: json['book_description'],
      sold: json['sold'],
      price: json['price'],
    );
  }
}
```

### 3. Using the generated class

we now have a typesafe'ish to interact with the database.

### Getting Table Name

```dart
  Books.table_name // "books"
  await supabase.from(Books.table_name).select();
```

### Fetch Data

```dart
// fetchedBooks is a typeof List<Books>
final fetchedBooks = await supabase
      .from(Books.table_name)
      .select("*")
      .withConverter((data) => data.map(Books.fromJson).toList());
```

### Insert Data

```dart
final data = Books.insert(
  book_name: 'Book Name',
  book_description: 'Description',
  price: 2,
);
await supabase.from(Books.table_name).insert(data);
```

### Inset Many Data

```dart
final many_data = [
  Books.insert(
    book_name: 'Book Name',
    book_description: 'Description',
    price: 2,
  ),
  Books.insert(
    book_name: 'Book Name 2',
    created_at: DateTime.now().toString(),
    price: 2,
  ),
];
await supabase.from(Books.table_name).insert(many_data);
```

### Update Data

```dart
final newData = Books.update(
  book_name: 'New Book Name',
  // we can update any field we want
);
await supabase
    .from(Books.table_name)
    .update(newData)
    .eq('id', 1)
```

### Delete Data

```dart
await supabase.from(Books.table_name).delete().eq('id', 1);
```

---

## Note

There are still things to do, the converter is not perfect, but it's a start.

I am not quite confident with the tool especially the generation of data types since there are so many postgres datatype, so please if you find any issue in the `SupabaseDartClassGenerator.ts` file, feel free to open an issue or a PR.
